<div class="row align-items-center">
  <div class="col-sm-4">
    <div class="d-flex">
      <button class="btn btn-refresh me-2" (click)="refresh()">
        <app-icon icon="arrow-clockwise" classe="text-dark"></app-icon>
        <span class="text-muted" style="font-size: 12px">Actualiser</span>
      </button>
      <app-search [url]="searchUrl" (results)="onSearches($event)">
      </app-search>
    </div>
  </div>
  <div class="col-sm-3 text-end">
    <button
      class="btn border btn-icons btn-primary"
      (click)="openModal('store')"
    >
      <app-icon icon="plus" [size]="18"></app-icon>
      Ajouter
    </button>
  </div>
</div>
<table class="table mt-0 table-hover">
  <thead>
    <tr>
      <th scope="col">Nom</th>
      <th scope="col">Tutelle</th>
      <th scope="col">Statut</th>
      <th scope="col">Actions</th>
    </tr>
  </thead>
  <tbody *ngIf="unite_admins.length > 0">
    <tr *ngFor="let uniteAdmin of unite_admins">
      <td>
        {{ uniteAdmin.sigle }}
        <p class="text-muted" style="font-size: 12px">
          {{ uniteAdmin.name }}
        </p>
      </td>
      <td>
        <div *ngIf="uniteAdmin.parent">
          {{ uniteAdmin.parent.sigle }}
          <p class="text-muted" style="font-size: 12px">
            {{ uniteAdmin.parent.name }}
          </p>
        </div>
        <div *ngIf="!uniteAdmin.parent">Aucune</div>
      </td>
      <td>
        <app-switch
          [checked]="uniteAdmin.status"
          (statusChangeEvent)="toggleStatus($event)"
          [activateId]="uniteAdmin.id"
        ></app-switch>
      </td>
      <td>
        <div class="btn-actions">
          <app-icon
            icon="pencil"
            (click)="edit(uniteAdmin.id)"
            [size]="16"
            classe="text-success"
          ></app-icon>
          <app-delete
            (canDelete)="destroy($event)"
            [activateId]="uniteAdmin.id"
          ></app-delete>
        </div>
      </td>
    </tr>
  </tbody>
</table>
<app-modal [action]="modalId" size="modal-md">
  <div heading class="fw-semibold text-primary text-center">
    {{ titre_formulaire }}
  </div>
  <form action="" quickv id="unite-admins-form">
    <div class="mb-4">
      <label for="" class="mb-1 d-block">
        <div class="row justify-content-between">
          <div class="col-6 required">Nom</div>
          <div class="col-6 text-end">
            <span info="Le nom de l'unité administrative">
              <app-icon icon="info" [size]="14"></app-icon>
            </span>
          </div>
        </div>
      </label>
      <div class="input-grouped">
        <input
          qv-rules="required"
          qv-messages="Le nom est requis"
          required
          type="text"
          name="name"
          class="form-control"
          [(ngModel)]="uadmin.name"
        />
      </div>
      <div qv-feedback="name"></div>
    </div>
    <div class="mb-4">
      <label for="" class="mb-1 d-block">
        <div class="row justify-content-between">
          <div class="col-6 required">Sigle</div>
          <div class="col-6 text-end">
            <span info="Le sigle de l'unité administrative">
              <app-icon icon="info" [size]="14"></app-icon>
            </span>
          </div>
        </div>
      </label>
      <div class="input-grouped">
        <input
          qv-rules="required"
          qv-messages="Le sigle est requis"
          required
          type="text"
          name="sigle"
          class="form-control"
          [(ngModel)]="uadmin.sigle"
        />
      </div>
      <div qv-feedback="sigle"></div>
    </div>
    <div class="mb-4">
      <label for="" class="mb-1 d-block">
        <div class="row justify-content-between">
          <div class="col-10">Unité administrative de tutelle</div>
          <div class="col-2 text-end">
            <span info="Sélectionnez l'unité administrative de tutelle">
              <app-icon icon="info" [size]="14"></app-icon>
            </span>
          </div>
        </div>
      </label>
      <div class="mb-4">
        <select
          class="form-select"
          name="ua_parent_id"
          [(ngModel)]="uadmin.ua_parent_id"
        >
          <option
            *ngFor="let uniteAdmin of unite_admins_filtered; let i = index"
            [value]="uniteAdmin.id"
          >
            {{ uniteAdmin.name }}
          </option>
        </select>
      </div>
      <div class="d-flex">
        <label for="admin-status" class="me-2">Statut (Actif / Inactif)</label>
        <div class="form-check form-switch mb-0">
          <input
            class="form-check-input"
            type="checkbox"
            role="switch"
            id="admin-status"
            name="status"
            checked
            [(ngModel)]="uadmin.status"
            value="1"
          />
        </div>
      </div>
      <p>
        <button
          class="btn btn-primary w-100"
          qv-submit
          (click)="save($event)"
          [disabled]="onLoading"
        >
          Enregistrer
          <span *ngIf="onLoading">
            <span
              class="spinner-border spinner-border-sm"
              role="status"
              aria-hidden="true"
            ></span>
            <span class="visually-hidden">Loading...</span>
          </span>
        </button>
      </p>
    </div>
  </form>
</app-modal>
